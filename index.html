<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eDHL/Poslaju/GDex Courier Logbook Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --primary: #0056b3;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --edhl: #0056b3;
            --poslaju: #008000;
            --gdex: #ff6600;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--primary);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-weight: 600;
            padding: 15px 20px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: #004494;
            border-color: #004494;
        }
        
        .btn-success {
            background-color: var(--success);
            border-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--danger);
            border-color: var(--danger);
        }
        
        .form-check-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .table th {
            font-weight: 600;
            color: var(--dark);
        }
        
        .login-container {
            max-width: 450px;
            margin: 80px auto;
        }
        
        .login-card {
            padding: 30px;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
        }
        
        .badge-courier {
            font-size: 0.85rem;
            padding: 5px 10px;
        }
        
        .badge-edhl {
            background-color: var(--edhl);
        }
        
        .badge-poslaju {
            background-color: var(--poslaju);
        }
        
        .badge-gdex {
            background-color: var(--gdex);
        }
        
        .status-badge {
            font-size: 0.85rem;
            padding: 5px 10px;
        }
        
        .status-pending {
            background-color: #ffc107;
            color: #212529;
        }
        
        .status-completed {
            background-color: var(--success);
        }
        
        .status-cancelled {
            background-color: var(--danger);
        }
        
        .activity-log-item {
            border-left: 3px solid var(--primary);
            padding-left: 15px;
            margin-bottom: 15px;
        }
        
        .ip-address {
            font-family: monospace;
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .checklist-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .modal-header {
            background-color: var(--primary);
            color: white;
        }
        
        .locked-field {
            background-color: #f8f9fa;
            pointer-events: none;
        }
        
        .commit-checklist {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .nav-link.active {
            color: var(--primary) !important;
            font-weight: 600;
        }
        
        .badge-role {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 12px;
        }
        
        .badge-admin {
            background-color: var(--primary);
            color: white;
        }
        
        .badge-crew {
            background-color: var(--secondary);
            color: white;
        }
        
        .table-responsive {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .cursor-pointer {
            cursor: pointer;
        }
        
        .profile-info-item {
            margin-bottom: 15px;
        }
        
        .profile-info-label {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .edit-btn {
            padding: 2px 8px;
            font-size: 0.8rem;
        }
        
        .logbook-entry {
            transition: all 0.2s;
        }
        
        .logbook-entry:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .status-pending-indicator {
            background-color: #ffc107;
        }
        
        .status-completed-indicator {
            background-color: var(--success);
        }
        
        .status-cancelled-indicator {
            background-color: var(--danger);
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="container">
        <div class="login-container">
            <div class="card login-card">
                <div class="card-body text-center">
                    <h3 class="mb-4">Courier Logbook Portal</h3>
                    <div class="mb-4">
                        <i class="fas fa-truck-moving fa-4x text-primary"></i>
                    </div>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="userId" class="form-label">User ID</label>
                            <input type="text" class="form-control" id="userId" placeholder="Enter your ID" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Login</button>
                    </form>
                    <div class="mt-3 text-muted small">
                        <p>For support, contact Danial Danish (ID: 7434)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardPage" class="container-fluid d-none">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-light sticky-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-truck-loading me-2"></i>
                    Courier Logbook Portal
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="navLogbook">Logbook</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="navProfile">Profile</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="navActivity">Activity Log</a>
                        </li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <span class="me-3">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="currentUserName">User</span>
                            <span id="currentUserRole" class="badge badge-role badge-crew ms-1">Crew</span>
                        </span>
                        <span class="me-3">
                            <i class="fas fa-globe me-1"></i>
                            <span class="ip-address" id="userIP">60.49.166.143</span>
                        </span>
                        <button class="btn btn-outline-danger btn-sm" id="logoutBtn">
                            <i class="fas fa-sign-out-alt me-1"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-4">
            <!-- Logbook Section -->
            <div id="logbookSection">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Courier Logbook</h5>
                                <button class="btn btn-primary btn-sm" id="addEntryBtn">
                                    <i class="fas fa-plus me-1"></i> New Entry
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Courier</th>
                                                <th>Consignment No</th>
                                                <th>Cashbill No</th>
                                                <th>Send To</th>
                                                <th>Status</th>
                                                <th>Created By</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="logbookEntries">
                                            <!-- Logbook entries will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Quick Stats</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3 text-primary">
                                                <i class="fas fa-box fa-2x"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Total Entries</h6>
                                                <h4 class="mb-0" id="totalEntries">0</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3 text-success">
                                                <i class="fas fa-check-circle fa-2x"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Completed</h6>
                                                <h4 class="mb-0" id="completedEntries">0</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3 text-warning">
                                                <i class="fas fa-clock fa-2x"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Pending</h6>
                                                <h4 class="mb-0" id="pendingEntries">0</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3 text-danger">
                                                <i class="fas fa-times-circle fa-2x"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Cancelled</h6>
                                                <h4 class="mb-0" id="cancelledEntries">0</h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <h5 class="mb-0">Recent Activity</h5>
                            </div>
                            <div class="card-body">
                                <div id="recentActivity">
                                    <!-- Recent activities will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="d-none">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body text-center">
                                <img src="https://picsum.photos/seed/danial123/200/200.jpg" class="profile-avatar mb-3" alt="Profile Avatar">
                                <h5 id="profileName">Danial Danish</h5>
                                <p class="text-muted" id="profileId">ID: 7434</p>
                                <p class="text-muted" id="profileRole">Administrator</p>
                                <button class="btn btn-primary btn-sm" id="editProfileBtn">
                                    <i class="fas fa-edit me-1"></i> Edit Profile
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">User Profile</h5>
                            </div>
                            <div class="card-body">
                                <form id="profileForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="profileFullName" value="Danial Danish" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">User ID</label>
                                            <input type="text" class="form-control" id="profileUserId" value="7434" readonly>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" id="profileEmail" value="danialdanish.amir@switch.com.my" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Phone</label>
                                            <input type="tel" class="form-control" id="profilePhone" value="+6012600969" readonly>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Department</label>
                                            <input type="text" class="form-control" id="profileDepartment" value="VM" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Position</label>
                                            <input type="text" class="form-control" id="profilePosition" value="Retail Sales Assistant" readonly>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Last Login</label>
                                        <input type="text" class="form-control" id="profileLastLogin" value="2023-10-18 09:15 AM" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Change Password</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="currentPassword" placeholder="Current Password">
                                            <input type="password" class="form-control" id="newPassword" placeholder="New Password">
                                            <button class="btn btn-outline-primary" type="button" id="changePasswordBtn">Update</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity Log Section -->
            <div id="activityLogSection" class="d-none">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Activity Log</h5>
                        <div class="input-group" style="width: 300px;">
                            <input type="text" class="form-control" placeholder="Search activities...">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date & Time</th>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Details</th>
                                        <th>IP Address</th>
                                    </tr>
                                </thead>
                                <tbody id="activityLogEntries">
                                    <!-- Activity logs will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Entry Modal -->
    <div class="modal fade" id="entryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="entryModalTitle">Add New Logbook Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="entryForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Pickup Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="pickupDate" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Courier <span class="text-danger">*</span></label>
                                <select class="form-select" id="courier" required>
                                    <option value="">Select Courier</option>
                                    <option value="eDHL">eDHL</option>
                                    <option value="Poslaju">Poslaju</option>
                                    <option value="GDex">GDex</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Consignment No <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="consignmentNo" placeholder="Enter Tracking Number" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Cashbill No</label>
                                <input type="text" class="form-control" id="cashbillNo" placeholder="For ENB/Remobie only">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Send To <span class="text-danger">*</span></label>
                                <select class="form-select" id="sendTo" required>
                                    <option value="">Select Partner</option>
                                    <option value="ENB">ENB</option>
                                    <option value="Remobie">Remobie</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="status">
                                    <option value="Pending">Pending</option>
                                    <option value="In Transit">In Transit</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-12">
                                <label class="form-label">Person In Charge <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="personInCharge" value="Danial Danish" required>
                            </div>
                        </div>
                        <div class="commit-checklist">
                            <h6>Commit Checklist</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="checklist1">
                                        <label class="form-check-label" for="checklist1">
                                            I confirm all information is correct
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="checklist2">
                                        <label class="form-check-label" for="checklist2">
                                            I accept responsibility for this entry
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mt-2">
                                <button type="button" class="btn btn-success" id="commitEntryBtn" disabled>
                                    <i class="fas fa-check-circle me-1"></i> Commit Entry
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEntryBtn">Save Entry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Only Danial Danish (ID: 7434) can edit crew profiles.
                    </div>
                    <form id="editProfileForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="editFullName" value="Danial Danish">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="editEmail" value="danialdanish.switch.com.my@company.com">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="editPhone" value="+60122600969">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Department</label>
                            <input type="text" class="form-control" id="editDepartment" value="VM">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Position</label>
                            <input type="text" class="form-control" id="editPosition" value="Retail Sales Assistant">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveProfileBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mock user data
        const users = [
            { id: '7434', name: 'Danial Danish', password: 'Dd123', role: 'RSA', email: 'danialdanish.amir@switch.com.my', phone: '+60123456789', department: 'VM', position: 'Retail Sales Assistant' },
            { id: '5546', name: 'Cindamani Anam', password: 'Ann123', role: 'RSE', email: '-', phone: '-', department: 'VM', position: 'Retail Sales Executive' },
            { id: '7407', name: 'Nur Sabrina', password: 'Sab123', role: 'RSA', email: '-', phone: '-', department: 'VM', position: 'Retail Sales Assistant' },
         
        ];

        // Mock logbook data
        let logbookEntries = [
            { id: 1, pickupDate: '2023-10-15', courier: 'Poslaju', consignmentNo: 'PS12345678', cashbillNo: 'CB98765', sendTo: 'ENB', status: 'Completed', personInCharge: 'Danial Danish', createdBy: 'Danial Danish', createdTime: '2023-10-15 09:30 AM', committed: true },
            
        ];

        // Mock activity logs
        let activityLogs = [
            { time: '2023-10-18 10:45 AM', user: 'Danial Danish (7434)', action: 'Updated Logbook Entry', details: 'Entry #1 - Status changed to Completed', ip: '60.49.166.143' },
        
        ];

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const dashboardPage = document.getElementById('dashboardPage');
        const logbookSection = document.getElementById('logbookSection');
        const profileSection = document.getElementById('profileSection');
        const activityLogSection = document.getElementById('activityLogSection');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const currentUserName = document.getElementById('currentUserName');
        const currentUserRole = document.getElementById('currentUserRole');
        const userIP = document.getElementById('userIP');
        const navLogbook = document.getElementById('navLogbook');
        const navProfile = document.getElementById('navProfile');
        const navActivity = document.getElementById('navActivity');
        const addEntryBtn = document.getElementById('addEntryBtn');
        const editEntryBtns = document.querySelectorAll('.edit-entry-btn');
        const editProfileBtn = document.getElementById('editProfileBtn');
        const saveEntryBtn = document.getElementById('saveEntryBtn');
        const commitEntryBtn = document.getElementById('commitEntryBtn');
        const checklist1 = document.getElementById('checklist1');
        const checklist2 = document.getElementById('checklist2');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const logbookEntriesTable = document.getElementById('logbookEntries');
        const activityLogEntries = document.getElementById('activityLogEntries');
        const recentActivity = document.getElementById('recentActivity');
        const totalEntries = document.getElementById('totalEntries');
        const completedEntries = document.getElementById('completedEntries');
        const pendingEntries = document.getElementById('pendingEntries');
        const cancelledEntries = document.getElementById('cancelledEntries');

        // Bootstrap Modal Instances
        const entryModal = new bootstrap.Modal(document.getElementById('entryModal'));
        const editProfileModal = new bootstrap.Modal(document.getElementById('editProfileModal'));

        // Current user state
        let currentUser = null;
        let currentEntryId = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set VM IP address
            userIP.textContent = '60.49.166.143';
            
            // Login form submission
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const userId = document.getElementById('userId').value;
                const password = document.getElementById('password').value;
                
                const user = users.find(u => u.id === userId && u.password === password);
                
                if (user) {
                    currentUser = user;
                    loginPage.classList.add('d-none');
                    dashboardPage.classList.remove('d-none');
                    currentUserName.textContent = user.name;
                    currentUserRole.textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1);
                    
                    // Show appropriate sections based on role
                    if (user.role === 'admin') {
                        editProfileBtn.classList.remove('d-none');
                    } else {
                        editProfileBtn.classList.add('d-none');
                    }
                    
                    // Populate data
                    populateLogbookEntries();
                    populateActivityLogs();
                    updateStats();
                    
                    // Show logbook section by default
                    showSection(logbookSection);
                } else {
                    alert('Invalid credentials. Please try again.');
                }
            });
            
            // Logout button
            logoutBtn.addEventListener('click', function() {
                currentUser = null;
                dashboardPage.classList.add('d-none');
                loginPage.classList.remove('d-none');
                loginForm.reset();
            });
            
            // Navigation
            navLogbook.addEventListener('click', function(e) {
                e.preventDefault();
                showSection(logbookSection);
            });
            
            navProfile.addEventListener('click', function(e) {
                e.preventDefault();
                showSection(profileSection);
            });
            
            navActivity.addEventListener('click', function(e) {
                e.preventDefault();
                showSection(activityLogSection);
            });
            
            // Add new entry button
            addEntryBtn.addEventListener('click', function() {
                document.getElementById('entryModalTitle').textContent = 'Add New Logbook Entry';
                document.getElementById('entryForm').reset();
                currentEntryId = null;
                entryModal.show();
            });
            
            // Edit entry buttons
            editEntryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const entryId = parseInt(this.getAttribute('data-id'));
                    document.getElementById('entryModalTitle').textContent = 'Edit Logbook Entry';
                    
                    // Find the entry to edit
                    const entry = logbookEntries.find(e => e.id === entryId);
                    if (entry) {
                        document.getElementById('pickupDate').value = entry.pickupDate;
                        document.getElementById('courier').value = entry.courier;
                        document.getElementById('consignmentNo').value = entry.consignmentNo;
                        document.getElementById('cashbillNo').value = entry.cashbillNo;
                        document.getElementById('sendTo').value = entry.sendTo;
                        document.getElementById('status').value = entry.status;
                        document.getElementById('personInCharge').value = entry.personInCharge;
                        currentEntryId = entryId;
                    }
                    
                    entryModal.show();
                });
            });
            
            // Edit profile button
            editProfileBtn.addEventListener('click', function() {
                editProfileModal.show();
            });
            
            // Save entry button
            saveEntryBtn.addEventListener('click', function() {
                const form = document.getElementById('entryForm');
                
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const entryData = {
                    pickupDate: document.getElementById('pickupDate').value,
                    courier: document.getElementById('courier').value,
                    consignmentNo: document.getElementById('consignmentNo').value,
                    cashbillNo: document.getElementById('cashbillNo').value,
                    sendTo: document.getElementById('sendTo').value,
                    status: document.getElementById('status').value,
                    personInCharge: document.getElementById('personInCharge').value,
                    createdBy: currentUser.name,
                    createdTime: getCurrentDateTime(),
                    committed: false
                };
                
                if (currentEntryId) {
                    // Update existing entry
                    const index = logbookEntries.findIndex(e => e.id === currentEntryId);
                    if (index !== -1) {
                        logbookEntries[index] = { ...logbookEntries[index], ...entryData };
                        addActivityLog(`Updated Logbook Entry`, `Entry #${currentEntryId} - Updated by ${currentUser.name}`);
                    }
                } else {
                    // Add new entry
                    const newId = logbookEntries.length > 0 ? Math.max(...logbookEntries.map(e => e.id)) + 1 : 1;
                    logbookEntries.push({ id: newId, ...entryData });
                    addActivityLog(`Created Logbook Entry`, `New entry created by ${currentUser.name}`);
                }
                
                entryModal.hide();
                populateLogbookEntries();
                updateStats();
            });
            
            // Commit entry button
            commitEntryBtn.addEventListener('click', function() {
                if (!currentEntryId) return;
                
                const index = logbookEntries.findIndex(e => e.id === currentEntryId);
                if (index !== -1) {
                    logbookEntries[index].committed = true;
                    addActivityLog(`Committed Logbook Entry`, `Entry #${currentEntryId} - Committed by ${currentUser.name}`);
                    entryModal.hide();
                    populateLogbookEntries();
                }
            });
            
            // Checklist functionality
            function updateCommitButton() {
                if (checklist1.checked && checklist2.checked) {
                    commitEntryBtn.disabled = false;
                } else {
                    commitEntryBtn.disabled = true;
                }
            }
            
            checklist1.addEventListener('change', updateCommitButton);
            checklist2.addEventListener('change', updateCommitButton);
            
            // Save profile button
            saveProfileBtn.addEventListener('click', function() {
                const name = document.getElementById('editFullName').value;
                const email = document.getElementById('editEmail').value;
                const phone = document.getElementById('editPhone').value;
                const department = document.getElementById('editDepartment').value;
                const position = document.getElementById('editPosition').value;
                
                // In a real app, we would save the profile changes
                // For demo, we'll just show a success message
                editProfileModal.hide();
                addActivityLog(`Edited User Profile`, `Updated profile for ${name}`);
                alert('Profile updated successfully!');
            });
            
            // Change password button
            changePasswordBtn.addEventListener('click', function() {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                
                if (currentPassword && newPassword) {
                    addActivityLog(`Changed Password`, `Password updated by ${currentUser.name}`);
                    alert('Password changed successfully!');
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                } else {
                    alert('Please enter both current and new password.');
                }
            });
            
            // Initialize with sample data
            populateLogbookEntries();
            populateActivityLogs();
            updateStats();
        });

        // Helper function to show sections
        function showSection(section) {
            logbookSection.classList.add('d-none');
            profileSection.classList.add('d-none');
            activityLogSection.classList.add('d-none');
            
            section.classList.remove('d-none');
            
            // Update active nav link
            navLogbook.classList.remove('active');
            navProfile.classList.remove('active');
            navActivity.classList.remove('active');
            
            if (section === logbookSection) {
                navLogbook.classList.add('active');
            } else if (section === profileSection) {
                navProfile.classList.add('active');
            } else if (section === activityLogSection) {
                navActivity.classList.add('active');
            }
        }

        // Populate logbook entries table
        function populateLogbookEntries() {
            logbookEntriesTable.innerHTML = '';
            
            logbookEntries.forEach(entry => {
                const row = document.createElement('tr');
                row.className = 'logbook-entry';
                
                // Status indicator
                let statusClass = '';
                let statusIcon = '';
                
                switch(entry.status) {
                    case 'Completed':
                        statusClass = 'status-completed-indicator';
                        statusIcon = '<i class="fas fa-check-circle"></i>';
                        break;
                    case 'Pending':
                        statusClass = 'status-pending-indicator';
                        statusIcon = '<i class="fas fa-clock"></i>';
                        break;
                    case 'Cancelled':
                        statusClass = 'status-cancelled-indicator';
                        statusIcon = '<i class="fas fa-times-circle"></i>';
                        break;
                    default:
                        statusClass = '';
                        statusIcon = '';
                }
                
                // Courier badge class
                let courierClass = '';
                switch(entry.courier) {
                    case 'eDHL':
                        courierClass = 'badge-edhl';
                        break;
                    case 'Poslaju':
                        courierClass = 'badge-poslaju';
                        break;
                    case 'GDex':
                        courierClass = 'badge-gdex';
                        break;
                }
                
                row.innerHTML = `
                    <td>${entry.pickupDate}</td>
                    <td><span class="badge badge-courier ${courierClass}">${entry.courier}</span></td>
                    <td>${entry.consignmentNo}</td>
                    <td>${entry.cashbillNo}</td>
                    <td>${entry.sendTo}</td>
                    <td>
                        <span class="badge status-badge status-${entry.status.toLowerCase().replace(' ', '-')}">
                            ${statusIcon} ${entry.status}
                        </span>
                    </td>
                    <td>${entry.createdBy}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary edit-entry-btn" data-id="${entry.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${currentUser.role === 'admin' && !entry.committed ? 
                                `<button class="btn btn-outline-danger delete-entry-btn" data-id="${entry.id}">
                                    <i class="fas fa-trash"></i>
                                </button>` : ''}
                        </div>
                    </td>
                `;
                
                logbookEntriesTable.appendChild(row);
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-entry-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const entryId = parseInt(this.getAttribute('data-id'));
                    document.getElementById('entryModalTitle').textContent = 'Edit Logbook Entry';
                    
                    // Find the entry to edit
                    const entry = logbookEntries.find(e => e.id === entryId);
                    if (entry) {
                        document.getElementById('pickupDate').value = entry.pickupDate;
                        document.getElementById('courier').value = entry.courier;
                        document.getElementById('consignmentNo').value = entry.consignmentNo;
                        document.getElementById('cashbillNo').value = entry.cashbillNo;
                        document.getElementById('sendTo').value = entry.sendTo;
                        document.getElementById('status').value = entry.status;
                        document.getElementById('personInCharge').value = entry.personInCharge;
                        currentEntryId = entryId;
                    }
                    
                    entryModal.show();
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-entry-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const entryId = parseInt(this.getAttribute('data-id'));
                    
                    if (confirm(`Are you sure you want to delete entry #${entryId}?`)) {
                        const index = logbookEntries.findIndex(e => e.id === entryId);
                        if (index !== -1) {
                            logbookEntries.splice(index, 1);
                            addActivityLog(`Deleted Logbook Entry`, `Entry #${entryId} - Deleted by ${currentUser.name}`);
                            populateLogbookEntries();
                            updateStats();
                        }
                    }
                });
            });
        }

        // Populate activity logs
        function populateActivityLogs() {
            activityLogEntries.innerHTML = '';
            recentActivity.innerHTML = '';
            
            activityLogs.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${log.time}</td>
                    <td>${log.user}</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                    <td class="ip-address">${log.ip}</td>
                `;
                activityLogEntries.appendChild(row);
            });
            
            // Recent activities (last 3)
            const recentLogs = activityLogs.slice(0, 3);
            recentLogs.forEach(log => {
                const div = document.createElement('div');
                div.className = 'activity-log-item';
                div.innerHTML = `
                    <p class="mb-1"><strong>${log.user}</strong> ${log.action}</p>
                    <small class="text-muted">${log.time}</small>
                `;
                recentActivity.appendChild(div);
            });
        }

        // Update statistics
        function updateStats() {
            const total = logbookEntries.length;
            const completed = logbookEntries.filter(e => e.status === 'Completed').length;
            const pending = logbookEntries.filter(e => e.status === 'Pending').length;
            const cancelled = logbookEntries.filter(e => e.status === 'Cancelled').length;
            
            totalEntries.textContent = total;
            completedEntries.textContent = completed;
            pendingEntries.textContent = pending;
            cancelledEntries.textContent = cancelled;
        }

        // Add activity log
        function addActivityLog(action, details) {
            const newLog = {
                time: getCurrentDateTime(),
                user: `${currentUser.name} (${currentUser.id})`,
                action: action,
                details: details,
                ip: userIP.textContent
            };
            
            activityLogs.unshift(newLog);
            populateActivityLogs();
        }

        // Get current date and time
        function getCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const formattedHours = hours % 12 || 12;
            
            return `${year}-${month}-${day} ${formattedHours}:${minutes} ${ampm}`;
        }
    </script>
</body>
</html>
